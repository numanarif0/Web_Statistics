@model Tuple<YokIstatistikWeb.Models.Universite, YokIstatistikWeb.Models.Universite>

@{
    var u1 = Model.Item1;
    var u2 = Model.Item2;

    int Toplam(IEnumerable<int?> sayilar) => sayilar.Sum(x => x ?? 0);

    var toplam1 = u1.birimler.Sum(b => b.toplam_toplam ?? 0);
    var toplam2 = u2.birimler.Sum(b => b.toplam_toplam ?? 0);

    var ortalama1 = toplam1 / Math.Max(1, u1.birimler.Count);
    var ortalama2 = toplam2 / Math.Max(1, u2.birimler.Count);

    var turler1 = new[] {
        Toplam(u1.birimler.Select(b => b.profesor_toplam)),
        Toplam(u1.birimler.Select(b => b.docent_toplam)),
        Toplam(u1.birimler.Select(b => b.doktor_ogretim_uyesi_toplam)),
        Toplam(u1.birimler.Select(b => b.ogretim_gorevlisi_toplam)),
        Toplam(u1.birimler.Select(b => b.arastirma_gorevlisi_toplam))
    };

    var turler2 = new[] {
        Toplam(u2.birimler.Select(b => b.profesor_toplam)),
        Toplam(u2.birimler.Select(b => b.docent_toplam)),
        Toplam(u2.birimler.Select(b => b.doktor_ogretim_uyesi_toplam)),
        Toplam(u2.birimler.Select(b => b.ogretim_gorevlisi_toplam)),
        Toplam(u2.birimler.Select(b => b.arastirma_gorevlisi_toplam))
    };

    var erkekKadin1 = new[] {
        Toplam(u1.birimler.Select(b => b.toplam_erkek)),
        Toplam(u1.birimler.Select(b => b.toplam_kadin))
    };

    var erkekKadin2 = new[] {
        Toplam(u2.birimler.Select(b => b.toplam_erkek)),
        Toplam(u2.birimler.Select(b => b.toplam_kadin))
    };
}

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<h2 class="text-center mt-4 mb-5 fw-bold text-uppercase">
    @Html.Raw(u1.universite) VS @Html.Raw(u2.universite)
</h2>

<div class="row mb-5">
    <div class="col-md-6">
        <div class="p-4 shadow rounded bg-white">
            <h4 class="mb-3 text-primary">@Html.Raw(u1.universite)</h4>
            <span class="badge bg-secondary mb-2">Şehir: @u1.sehir</span><br />
            <span class="badge bg-info text-dark mb-2">Tür: @u1.tur</span><br />
            <span class="badge bg-success">Toplam Öğretim Elemanı: @toplam1</span><br />
            <span class="badge bg-warning text-dark mt-2">Birim Sayısı: @u1.birimler.Count</span><br />
            <span class="badge bg-dark text-white mt-2">Ortalama: @ortalama1 kişi/birim</span>
        </div>
    </div>
    <div class="col-md-6">
        <div class="p-4 shadow rounded bg-white">
            <h4 class="mb-3 text-primary">@Html.Raw(u2.universite)</h4>
            <span class="badge bg-secondary mb-2">Şehir: @u2.sehir</span><br />
            <span class="badge bg-info text-dark mb-2">Tür: @u2.tur</span><br />
            <span class="badge bg-success">Toplam Öğretim Elemanı: @toplam2</span><br />
            <span class="badge bg-warning text-dark mt-2">Birim Sayısı: @u2.birimler.Count</span><br />
            <span class="badge bg-dark text-white mt-2">Ortalama: @ortalama2 kişi/birim</span>
        </div>
    </div>
</div>

<div id="chart_total" style="width: 100%; height: 400px;"></div>
<div id="chart_tur" style="width: 100%; height: 400px;" class="mt-5"></div>

<div class="row mb-5 mt-5">
    <div class="col-md-6">
        <div id="pie1" style="width: 100%; height: 300px;"></div>
    </div>
    <div class="col-md-6">
        <div id="pie2" style="width: 100%; height: 300px;"></div>
    </div>
</div>

<div class="text-center mt-4">
    <a class="btn btn-secondary" href="@Url.Action("Index", "Yuksekogretim")">← Ana Sayfa</a>
</div>

<script>
    google.charts.load("current", { packages: ["corechart"] });
    google.charts.setOnLoadCallback(drawAll);

    function drawAll() {
        drawTotal();
        drawTur();
        drawPie1();
        drawPie2();
    }

    function drawTotal() {
        var data = google.visualization.arrayToDataTable([
            ["Üniversite", "Toplam", { role: "style" }],
            [@Html.Raw("'" + u1.universite + "'"), @toplam1, "#007bff"],
            [@Html.Raw("'" + u2.universite + "'"), @toplam2, "#28a745"]
        ]);

        var options = {
            title: "Toplam Öğretim Elemanı Karşılaştırması",
            legend: { position: "none" },
            chartArea: { width: "60%" },
            hAxis: { minValue: 0 }
        };

        var chart = new google.visualization.BarChart(document.getElementById("chart_total"));
        chart.draw(data, options);
    }

    function drawTur() {
        var data = google.visualization.arrayToDataTable([
            ["Tür", @Html.Raw("'" + u1.universite + "'"), @Html.Raw("'" + u2.universite + "'")],
            ["Profesör", @turler1[0], @turler2[0]],
            ["Doçent", @turler1[1], @turler2[1]],
            ["Dr. Öğr. Üyesi", @turler1[2], @turler2[2]],
            ["Öğr. Görevlisi", @turler1[3], @turler2[3]],
            ["Araş. Görevlisi", @turler1[4], @turler2[4]]
        ]);

        var options = {
            title: "Öğretim Elemanı Türü Karşılaştırması",
            chartArea: { width: "60%" },
            hAxis: { minValue: 0 },
            isStacked: false
        };

        var chart = new google.visualization.BarChart(document.getElementById("chart_tur"));
        chart.draw(data, options);
    }

    function drawPie1() {
        var data = google.visualization.arrayToDataTable([
            ["Cinsiyet", "Kişi"],
            ["Erkek", @erkekKadin1[0]],
            ["Kadın", @erkekKadin1[1]]
        ]);

        var options = {
            title: @Html.Raw("'" + u1.universite + " - Cinsiyet Dağılımı'") ,
            is3D: true
        };

        var chart = new google.visualization.PieChart(document.getElementById("pie1"));
        chart.draw(data, options);
    }

    function drawPie2() {
        var data = google.visualization.arrayToDataTable([
            ["Cinsiyet", "Kişi"],
            ["Erkek", @erkekKadin2[0]],
            ["Kadın", @erkekKadin2[1]]
        ]);

        var options = {
            title: @Html.Raw("'" + u2.universite + " - Cinsiyet Dağılımı'") ,
            is3D: true
        };

        var chart = new google.visualization.PieChart(document.getElementById("pie2"));
        chart.draw(data, options);
    }
</script>
